# FakeMan 持续思考系统 - 使用指南

## 🚀 快速开始（3分钟）

### 步骤 1: 运行测试
```bash
python test_continuous_system.py
```
看到 `✅ 所有测试通过！` 继续下一步。

### 步骤 2: 启动主系统（终端 1）
```bash
$env:PYTHONIOENCODING='utf-8'
python main.py
```

你会看到：
```
============================================================
FakeMan 持续思考系统
============================================================

正在初始化...
[初始化日志...]

启动持续思考循环...
============================================================
[静默思考#10] 主导: existing=0.400 | 距上次行动: 5s | 无充分理由
[静默思考#20] 主导: existing=0.400 | 距上次行动: 15s | 无充分理由
...
```

**说明**: 
- 系统每秒思考一次
- 每10秒输出一次状态（避免刷屏）
- `[静默思考#N]` 表示第N个思考周期

### 步骤 3: 启动聊天界面（终端 2）
```bash
$env:PYTHONIOENCODING='utf-8'
python chat.py
```

你会看到：
```
============================================================
  FakeMan 聊天界面
============================================================

系统状态: running
当前欲望:
  💚 existing     : 0.400
  ⚡ power        : 0.200
  ...

你: 
```

### 步骤 4: 开始对话
```
你: 你好
[FakeMan 正在思考...]

FakeMan: 你好！很高兴认识你。

[思考] 用户打招呼，选择友好回应
```

## 📊 系统运行状态说明

### 主系统（main.py）输出解读

#### 初始化阶段
```
正在初始化...
19:33:20 - fakeman - INFO - FakeMan 系统初始化开始
19:33:20 - fakeman.memory.database - INFO - 记忆数据库初始化完成，已加载 0 条经验
19:33:20 - fakeman.acting_bot - INFO - Acting Bot 初始化完成
...
```

#### 静默思考阶段
```
[静默思考#10] 主导: existing=0.400 | 距上次行动: 5s | 无充分理由
```
- `#10`: 第10个思考周期
- `主导: existing=0.400`: 当前主导欲望是 existing，值为 0.400
- `距上次行动: 5s`: 距离上次行动（启动或上次回复）5秒
- `无充分理由`: 评估结果是不需要主动行动

#### 收到用户输入
```
============================================================
收到用户输入: 你好
============================================================
步骤1: 生成目的
  目的: 维持存在和对话连续性
  ...
步骤3: 思考与行动
  思考次数: 1
  行动: 你好！很高兴认识你。
```

#### 主动发言
```
[主动思考] 决定主动行动: existing欲望驱动（0.62）, 预期收益: 0.186

============================================================
主动行动周期 #3
原因: existing欲望驱动（0.62）
============================================================
目的: 维持存在和对话连续性
...
行动: 我们要不要继续聊聊？
```

### 聊天界面（chat.py）显示

#### 普通回复
```
FakeMan: 你好！很高兴认识你。

[思考] 用户打招呼，选择友好回应
```

#### 主动发言（会有特殊标识）
```
💡 [FakeMan 主动发言]
FakeMan: 我们要不要继续聊聊？

[思考] existing欲望驱动，主动维持对话连续性
```

## 🎮 命令参考

在 chat.py 中可以输入的命令：

### `state` / `s` - 查看系统状态
```
你: state

------------------------------------------------------------
  系统状态
------------------------------------------------------------
  状态: running
  周期: 5
  思考周期: 127

  当前欲望:
    💚 existing     : 0.453
    ⚡ power        : 0.245
    🤝 understanding: 0.169
    📚 information  : 0.133

  当前上下文:
    用户询问系统状态...
```

### `desires` / `d` - 查看欲望详情
```
你: desires

------------------------------------------------------------
  欲望状态
------------------------------------------------------------
  💚 existing     : ████████████░░░░░░░░ 0.453 ⭐
  ⚡ power        : █████░░░░░░░░░░░░░░░ 0.245
  🤝 understanding: ███░░░░░░░░░░░░░░░░░ 0.169
  📚 information  : ██░░░░░░░░░░░░░░░░░░ 0.133
```

### `history` / `h` - 查看对话历史
```
你: history

------------------------------------------------------------
  对话历史
------------------------------------------------------------

--- 回合 1 ---
你: 你好
FakeMan: 你好！很高兴认识你。
主导欲望: existing = 0.453

--- 回合 2 [主动] ---
你: (主动发言)
FakeMan: 我们要不要继续聊聊？
主导欲望: existing = 0.620
```

### `quit` / `exit` / `q` - 退出
```
你: quit

============================================================
  对话结束
============================================================
  总对话轮次: 5
  主动发言次数: 2

  感谢使用 FakeMan！
```

## ⚙️ 调整主动行动频率

如果你想让 AI 更主动或更被动，可以修改 `main.py`：

### 位置 1: 最小时间间隔（第 253 行）
```python
# 降低这个值让 AI 更频繁地主动发言
if time_since_last < 30:  # 改为 10 会更频繁
    return False, "时间间隔太短", 0.0
```

### 位置 2: existing 欲望阈值（第 270 行）
```python
# 降低阈值让 AI 更容易触发主动发言
if dominant_value > 0.5 and time_since_last > 60:  # 改为 0.4 和 30
    expected_benefit = dominant_value * 0.3
    return True, f"{dominant_desire}欲望驱动（{dominant_value:.2f}）", expected_benefit
```

### 位置 3: information 欲望阈值（第 276 行）
```python
if dominant_value > 0.3 and pressure > 0.2:  # 改为 0.2 和 0.1
    expected_benefit = dominant_value * 0.4
    return True, f"{dominant_desire}欲望驱动，需要减少不确定性", expected_benefit
```

## 📝 理解思考周期

系统有两种周期计数：

### 思考周期（think_cycle）
- 每秒增加 1
- 表示系统运行了多少秒
- 用于控制输出频率
- 显示在 `[静默思考#N]` 中

### 决策周期（cycle_count）
- 只在有实际行动时增加
- 表示做了多少次决策（回复或主动发言）
- 记录在经验数据库中
- 显示在日志和状态中

示例：
```
think_cycle = 127  （运行了127秒）
cycle_count = 3    （做了3次决策：2次回复，1次主动）
```

## 🔍 查看详细日志

如果你想看到更详细的系统运行信息：

### 实时查看主日志
```bash
# Windows PowerShell
Get-Content data\logs\fakeman.log -Wait -Tail 50

# Linux/Mac
tail -f data/logs/fakeman.log
```

### 查看决策周期日志
```bash
Get-Content data\logs\decision_cycles.jsonl -Tail 10
```

### 查看欲望变化日志
```bash
Get-Content data\logs\desire_changes.jsonl -Tail 10
```

## 💡 使用技巧

### 1. 观察主动行动
- 启动系统后，**不要**立即输入
- 等待至少 60 秒
- 观察系统是否主动发言
- 如果没有，查看静默思考输出中的欲望值

### 2. 影响欲望状态
- 友好对话 → 增加 understanding 欲望
- 提问 → 增加 information 欲望
- 长时间沉默 → 增加 existing 欲望
- 展示能力的话题 → 增加 power 欲望

### 3. 触发主动发言
1. 先进行 2-3 轮正常对话
2. 然后停止输入
3. 等待 60-120 秒
4. 观察欲望变化（用 `state` 命令）
5. 当 existing > 0.5 时，AI 很可能主动发言

### 4. 查看思考过程
- 每次回复后都会显示 `[思考]` 摘要
- 想看完整思考，查看 `data/logs/fakeman.log`

## 🐛 常见问题

### Q: 系统启动后没有任何输出？
A: 检查：
1. 是否设置了 `$env:PYTHONIOENCODING='utf-8'`
2. 是否有 DEEPSEEK_API_KEY
3. 等待10秒，应该会看到 `[静默思考#10]` 输出

### Q: chat.py 提示系统未运行？
A: 确保 main.py 在另一个终端运行，状态文件显示 "running"

### Q: AI 从不主动发言？
A: 
1. 检查距上次行动的时间（需要 >60s）
2. 查看欲望状态（existing 需要 >0.5）
3. 尝试降低阈值（见上文"调整主动行动频率"）

### Q: 响应很慢？
A: 
1. 检查网络连接到 DeepSeek API
2. 首次调用可能较慢（模型加载）
3. 后续调用应该在 3-10 秒内

## 📚 进一步阅读

- `README_CONTINUOUS_THINKING.md` - 完整功能说明
- `docs/CONTINUOUS_THINKING.md` - 技术架构文档
- `SYSTEM_SUMMARY.md` - 实现总结
- `DEPLOYMENT_CHECKLIST.md` - 部署检查清单

---

**享受与 FakeMan 的对话！** 🎉

