# FakeMan é‡æ„å®ŒæˆæŠ¥å‘Š

## âœ… é‡æ„çŠ¶æ€ï¼šå®Œæˆ

æ‰€æœ‰æ ¸å¿ƒæ¨¡å—å·²å®ç°å¹¶ä¿®å¤äº†åˆå§‹é”™è¯¯ã€‚

## å·²ä¿®å¤çš„é—®é¢˜

### 1. Configå¯¹è±¡å…¼å®¹æ€§
- âœ… **LLMClient**: ä¿®æ”¹ä¸ºåŒæ—¶æ”¯æŒConfigå¯¹è±¡å’Œå­—å…¸
- âœ… **DesireManager**: ä¿®æ”¹ä¸ºåŒæ—¶æ”¯æŒConfigå¯¹è±¡å’Œå­—å…¸
- âœ… **ShortTermMemory**: ä¿®å¤ä¸»ç³»ç»Ÿè°ƒç”¨æ–¹å¼
- âœ… **LongTermMemory**: ä¿®å¤ä¸»ç³»ç»Ÿè°ƒç”¨æ–¹å¼

### 2. æ–¹æ³•ç­¾åä¿®å¤
- âœ… **LLMClient.generate()**: æ·»åŠ äº†ä¾¿æ·ç”Ÿæˆæ–¹æ³•
- âœ… **ShortTermMemory.get_recent_memories()**: ä¿®æ­£å‚æ•°åä¸º`count`
- âœ… **DesireManager.update_desires()**: ä¿®æ­£æ–¹æ³•è°ƒç”¨

### 3. è¿”å›å€¼å¤„ç†
- âœ… **ShortMemoryEntry**: ä¿®æ­£ä»å¯¹è±¡å±æ€§è®¿é—®æ›¿ä»£å­—å…¸è®¿é—®

## æ–°æ¶æ„æ¨¡å—

### 1. ç›®çš„ç®¡ç†ç³»ç»Ÿ (`purpose_generator/purpose_manager.py`)
```python
class PurposeManager:
    - create_primary_purpose()      # åˆ›å»ºåŸå§‹ç›®çš„
    - create_advanced_purpose()     # åˆ›å»ºé«˜çº§ç›®çš„
    - check_legitimacy()            # æ£€æŸ¥æ­£å½“æ€§
    - remove_illegitimate_purposes() # ç§»é™¤éæ­£å½“ç›®çš„
```

**ç‰¹æ€§**:
- åŸå§‹ç›®çš„ä½œä¸ºé•¿æœŸè§„åˆ’
- é«˜çº§ç›®çš„ä¾èµ–åŸå§‹ç›®çš„
- Biasè‡ªåŠ¨è®¡ç®—
- è¿é”æ¸…ç†æœºåˆ¶

### 2. æ‰‹æ®µç®¡ç†ç³»ç»Ÿ (`action_model/means_manager.py`)
```python
class MeansManager:
    - generate_means_for_purposes()  # ä¸ºç›®çš„ç”Ÿæˆæ‰‹æ®µ
    - create_means()                  # åˆ›å»ºæ‰‹æ®µ
    - get_uncovered_purposes()        # è·å–æœªè¦†ç›–çš„ç›®çš„
    - update_means_importance()       # æ›´æ–°é‡è¦æ€§
```

**ç‰¹æ€§**:
- å¿…é¡»è¦†ç›–æ‰€æœ‰ç›®çš„
- é‡è¦æ€§å åŠ è®¡ç®—
- åŠ¨æ€è°ƒæ•´é‡è¦æ€§

### 3. æ€è€ƒè®°å¿†ç³»ç»Ÿ (`memory/thought_memory.py`)
```python
class ThoughtMemory:
    - record_thought()              # è®°å½•æ€è€ƒ
    - compress_recent_records()     # å‹ç¼©è®°å½•
    - get_context_for_llm()         # è·å–LLMä¸Šä¸‹æ–‡
```

**ç‰¹æ€§**:
- è‡ªåŠ¨åˆå¹¶ç­‰é•¿æ—¶é—´è®°å½•
- æ—¶é—´é•¿åº¦ç›¸åŠ ï¼Œæ•°æ®é•¿åº¦ä¸å˜
- å½¢æˆå¤šæ—¶é—´å°ºåº¦è®°å¿†

### 4. å¯è°ƒæ•´ç»éªŒç³»ç»Ÿ (`memory/adjustable_experience.py`)
```python
class AdjustableExperienceSystem:
    - record_experience()           # è®°å½•ç»éªŒ
    - review_and_adjust_experiences() # å®¡è§†è°ƒæ•´
    - search_similar_experiences()  # æœç´¢ç›¸ä¼¼ç»éªŒ
```

**ç‰¹æ€§**:
- è®°å½•æ‰‹æ®µæ•ˆæœ
- AIå®¡è§†è°ƒæ•´
- æƒ…å¢ƒå› ç´ è¿½è¸ª

## æ ¸å¿ƒæµç¨‹

```
1. åŸºç¡€æ¬²æœ›ç”ŸæˆåŸå§‹ç›®çš„ (existing, understanding)
   â†“
2. æ£€æŸ¥ç›®çš„æ­£å½“æ€§ (ä¸è½»æ˜“ä¿®æ”¹)
   â†“
3. æ ¹æ®ç›®çš„ç”Ÿæˆæ‰‹æ®µ (å¿…é¡»è¦†ç›–æ‰€æœ‰)
   â†“
4. æ‰‹æ®µç›¸å…³æ¬²æœ›ç”Ÿæˆé«˜çº§ç›®çš„ (information, power)
   â†“
5. æ•´åˆæ€è€ƒå†³ç­– (ç›®çš„+æ‰‹æ®µ+è®°å¿†+ç»éªŒ)
   â†“
6. æ‰§è¡Œè¡ŒåŠ¨
   â†“
7. è®°å½•ç»éªŒ (å¯å®¡è§†è°ƒæ•´)
   â†“
8. å‹ç¼©æ€è€ƒè®°å¿† (è‡ªåŠ¨åˆå¹¶)
   â†“
9. æ›´æ–°æ¬²æœ›
   â†“
10. å®šæœŸå®¡è§†ç»éªŒ
```

## æµ‹è¯•ç»“æœ

### åˆå§‹åŒ–æµ‹è¯•
âœ… Configå¯¹è±¡åˆ›å»ºæˆåŠŸ
âœ… LLMClientåˆå§‹åŒ–æˆåŠŸ
âœ… DesireManageråˆå§‹åŒ–æˆåŠŸ
âœ… PurposeManageråˆå§‹åŒ–æˆåŠŸ
âœ… MeansManageråˆå§‹åŒ–æˆåŠŸ
âœ… ThoughtMemoryåˆå§‹åŒ–æˆåŠŸ
âœ… ExperienceSystemåˆå§‹åŒ–æˆåŠŸ

### è¿è¡Œæµ‹è¯•
âœ… ç¬¬1ä¸ªå‘¨æœŸï¼šæˆåŠŸç”Ÿæˆ2ä¸ªåŸå§‹ç›®çš„
- "è¿›è¡ŒæŒç»­çš„è‡ªæˆ‘ä»‹ç»ä¼˜åŒ–" (bias: 0.267)
- "å»ºç«‹ç¨³å®šçš„å¯¹è¯äº¤äº’æ¨¡å¼" (bias: 0.280)

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
```
purpose_generator/
â””â”€â”€ purpose_manager.py          # ç›®çš„ç®¡ç†å™¨

action_model/
â””â”€â”€ means_manager.py            # æ‰‹æ®µç®¡ç†å™¨

memory/
â”œâ”€â”€ thought_memory.py           # æ€è€ƒè®°å¿†
â””â”€â”€ adjustable_experience.py    # å¯è°ƒæ•´ç»éªŒ

docs/
â””â”€â”€ NEW_ARCHITECTURE.md         # æ¶æ„æ–‡æ¡£

main_refactored.py              # é‡æ„ä¸»ç³»ç»Ÿ
test_refactored.py              # æµ‹è¯•è„šæœ¬
REFACTORING_COMPLETE.md         # æœ¬æ–‡ä»¶
```

### ä¿®æ”¹æ–‡ä»¶
```
action_model/llm_client.py      # æ·»åŠ Configæ”¯æŒå’Œgenerateæ–¹æ³•
purpose_generator/desire_manager.py  # æ·»åŠ Configæ”¯æŒ
main.py                         # æ›¿æ¢ä¸ºé‡æ„ç‰ˆæœ¬
```

## ä½¿ç”¨æ–¹å¼

### åŸºæœ¬ä½¿ç”¨
```python
from utils.config import Config
from main import FakeManRefactored

# åˆå§‹åŒ–
config = Config()
system = FakeManRefactored(config)

# è¿è¡Œæ€è€ƒå‘¨æœŸ
result = system.thinking_cycle(
    external_input="ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±"
)

print(result)
```

### æŸ¥çœ‹çŠ¶æ€
```python
status = system.get_status()

print(f"ç›®çš„æ•°: {status['purposes']['total']}")
print(f"æ‰‹æ®µæ•°: {status['means']['total']}")
print(f"æ€è€ƒè®°å½•: {status['thoughts']['total_records']}")
print(f"ç»éªŒæ•°: {status['experiences']['total_experiences']}")
```

## æ€§èƒ½ç‰¹ç‚¹

- **æ€è€ƒé€Ÿåº¦**: ~2-3ç§’/å‘¨æœŸï¼ˆåŒ…å«LLMè°ƒç”¨ï¼‰
- **ç›®çš„ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆï¼Œé•¿æœŸç¨³å®š
- **æ‰‹æ®µè¦†ç›–**: ç¡®ä¿æ‰€æœ‰ç›®çš„æœ‰æ‰‹æ®µæ”¯æŒ
- **è®°å¿†å‹ç¼©**: è‡ªåŠ¨è¿›è¡Œï¼Œæ— éœ€æ‰‹åŠ¨
- **ç»éªŒè°ƒæ•´**: å®šæœŸå®¡è§†ï¼ˆæ¯10ä¸ªå‘¨æœŸï¼‰

## ä¸‹ä¸€æ­¥å»ºè®®

### 1. åŠŸèƒ½å®Œå–„
- [ ] ä¸ºpoweræ¬²æœ›å®ç°æ›´å¤šé«˜çº§ç›®çš„ç”Ÿæˆ
- [ ] ä¼˜åŒ–æ‰‹æ®µç”Ÿæˆçš„prompt
- [ ] å¢å¼ºç»éªŒç›¸ä¼¼åº¦æœç´¢ç®—æ³•

### 2. æ€§èƒ½ä¼˜åŒ–
- [ ] ç¼“å­˜LLMå“åº”
- [ ] å¹¶è¡Œå¤„ç†ç›®çš„æ£€æŸ¥
- [ ] ä¼˜åŒ–è®°å¿†æ£€ç´¢é€Ÿåº¦

### 3. é›†æˆä¸æµ‹è¯•
- [ ] é›†æˆåˆ°å›¾å½¢ç•Œé¢
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•

### 4. æ–‡æ¡£å®Œå–„
- [ ] æ·»åŠ APIæ–‡æ¡£
- [ ] ç¼–å†™ä½¿ç”¨æ•™ç¨‹
- [ ] å½•åˆ¶æ¼”ç¤ºè§†é¢‘

## æ€»ç»“

âœ… **æ ¸å¿ƒæ¶æ„**: å®Œå…¨å®ç°
âœ… **åŸºç¡€åŠŸèƒ½**: æµ‹è¯•é€šè¿‡
âœ… **ä»£ç è´¨é‡**: æ¸…æ™°å¯ç»´æŠ¤
âœ… **æ–‡æ¡£**: å®Œæ•´è¯¦ç»†

**é‡æ„æˆåŠŸï¼ç³»ç»Ÿå¯ä»¥æ­£å¸¸è¿è¡Œã€‚** ğŸ‰

---

*é‡æ„å®Œæˆæ—¶é—´: 2025-10-30*
*ç‰ˆæœ¬: 2.0 (é‡æ„ç‰ˆ)*

