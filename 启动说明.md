# FakeMan 系统启动说明

## 问题诊断和修复

### 已修复的问题：

1. **启动时的循环逻辑问题**
   - 修复了 `main.py` 中第一次循环不执行思考的问题
   - 现在系统会立即开始第一个思考周期

2. **Windows编码问题**
   - 添加了UTF-8输出支持，避免中文乱码
   - 使用 `reconfigure()` 方法安全地设置编码

3. **API连接问题**
   - 确认DeepSeek API配置正确
   - 系统可以正常调用API并获取响应

4. **代码bug修复**
   - 修复了 `main_refactored.py` 中的参数错误
   - 修复了短期记忆调用参数问题

## 启动方式

### 1. 交互模式（推荐新手使用）

```bash
python run_fakeman.py
```

**功能**：
- 提供友好的命令行交互界面
- 可以直接与AI对话
- 支持查看系统状态、目的列表、手段列表等命令

**可用命令**：
- 直接输入文本：与AI对话
- `status` 或 `s`：查看系统状态
- `purposes` 或 `p`：查看目的列表
- `means` 或 `m`：查看手段列表
- `abilities` 或 `a`：查看可用能力
- `help` 或 `h`：显示帮助
- `quit` 或 `q`：退出系统

### 2. 持续运行模式

```bash
python main.py
```

**功能**：
- 系统持续运行，监听通信文件
- 每30秒执行一次内部思考
- 适合后台运行或与GUI集成

**停止方式**：按 `Ctrl+C` 安全退出

### 3. 简化版本（测试）

```bash
python main_refactored.py
```

**功能**：
- 运行5个测试周期后自动退出
- 适合快速测试系统是否正常工作

## 测试脚本

### API连接测试

```bash
python test_api.py
```

测试DeepSeek API是否连接正常。

### 完整系统测试

```bash
python test_system.py
```

测试整个系统的初始化和运行。

## 日志位置

所有日志文件存储在 `data/logs/` 目录下：

- `fakeman.main_refactored.log` - 主程序日志
- `fakeman.llm.log` - LLM API调用日志
- `fakeman.*.log` - 其他组件日志

## 常见问题

### Q: 启动后没有DeepSeek API输出

**已修复！** 原因是：
1. 系统启动后第一次循环不满足执行条件
2. 需要等待30秒才开始第一次思考

**解决方案**：
- 已修改 `main.py` 中的循环逻辑
- 现在启动后立即执行第一个思考周期

### Q: 中文乱码

**已修复！** 使用 `sys.stdout.reconfigure(encoding='utf-8')` 设置输出编码。

### Q: 如何查看API调用情况

查看日志文件：
```bash
cat data/logs/fakeman.llm.log
```

或在交互模式下输入 `status` 命令查看系统状态。

## 环境要求

确保已安装所有依赖：

```bash
pip install -r requirements.txt
```

确保 `.env` 文件中配置了 `DEEPSEEK_API_KEY`：

```
DEEPSEEK_API_KEY=你的API密钥
```

## 下一步

1. 启动系统：`python run_fakeman.py`
2. 与AI对话，观察系统行为
3. 使用 `status` 命令查看欲望、目的、手段的变化
4. 使用 `purposes` 和 `means` 命令深入了解系统的决策过程

祝使用愉快！

